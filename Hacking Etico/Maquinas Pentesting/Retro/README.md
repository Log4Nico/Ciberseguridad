# Retro

Esta room es igual a una anterior vista, [Blaster](../Blaster/), la única direferencia esq esta no te guía tanto en THM, pero la resolución es igual, quitando un molesto bug que aparece en Windows Server, que no nos deja escalar privilegios de la misma manera.

# Análisis

Empezamos con un escaneo de puertos a la máquina host:

![alt text](img/image.png)
> El creado nos dice que no podemos hacer ping a la máquina, por eso ponemos -Pn.

![alt text](img/image-1.png)

Esto es lo que encontramos en el puerto 80 de la máquina, parece el index por defecto de Microsoft IIS.
Hagamos un fuzzeo de los directorios para ver qué encontramos:

![alt text](img/image-2.png)
> /retro y /Retro son el mismo directorio.

Encontramos el direcorio /retro, el cual parece ser un blog personal de wade en el que habla abiertamente de videojuegos, peliculas y curiosidadaes de estos:

![alt text](img/image-3.png)

Si investigamos un poco, veremos la siguiente entrada en el blog:

![alt text](img/image-4.png)

En esta entrada, wade nos da una pista de su contraseña para logearse en el sistema, se trata del nombre del avatar del personaje con su mismo nombre de la película/libro *Ready Player One*.

![alt text](img/image-5.png)

![alt text](img/image-6.png)

Igualmente, wade nos dice cual es su contraseña en un comentario de la entrada.
Usamos Remmina para conectarnos por escritorio remoto a la máquina host con las credenciales que hemos encontrado:

![alt text](img/image-7.png)

![alt text](img/image-8.png)
> Encontramos la primera flag.

En la papelera encontramos el siguiente archivo que, de momento, no sabemos lo que es o hace.

![alt text](img/image-9.png)

En el historial del naveagdor encontramos la siguiente página:

![alt text](img/image-10.png)

Se trata del CVE-2019-1388, cuya explotación viene explicada en el siguiente [repositorio](https://github.com/nobodyatall648/CVE-2019-1388).

Iniciamos la aplicación que encontramos en la papelera:

![alt text](img/image-11.png)

Le damos a *Show more details*:

![alt text](img/image-12.png)

Y a la página del certificado:

![alt text](img/image-13.png)

En este punto, deberíamos seguir los pasos que hicimos en la room de *Blaster*, pero aparece lo siguiente:

![alt text](img/image-14.png)

Aquí debería salirnos google chrom o internet explorer, pero no lo hace, investigando un poco, enocntré que es esto es un bug del windows server, por lo que no podemos resolver la máquina de la misma forma.
Buscando en internet(y preguntando a ChatGPT) encontre el siguiente [CVE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0213):

![alt text](img/image-15.png)

Permite escalar privilegios cuando iniciamos una aplicación específica. En el repositorio de  [eonrickity](https://github.com/eonrickity/CVE-2017-0213) encontramos la aplicación que necesitamos para escalar privilegios, simplemente, nos la descargamos y se la pasamos al host creando un servidor web con python:

![alt text](img/image-16.png)
![alt text](img/image-17.png)

Nos la descargamos la ejecutamos, y automaticamente seremos administradores:

![alt text](img/image-18.png)
![alt text](img/image-19.png)
![alt text](img/image-20.png)
> Como no podemos copiar y pegar en esta terminal, hacemos un type(cat de windows) y lo redirigimos al escritorio de wade.

![alt text](img/image-21.png)
> Última flag encontrada.