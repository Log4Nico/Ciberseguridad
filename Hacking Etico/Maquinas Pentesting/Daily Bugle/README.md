# Daily Bugle

# Análisis

Empezamos la máquina con un escaneo de puertos:

![alt text](img/image.png)

Vemos varios puertos abiertos, el puerto 22(OpenSSH 7.4), el 80(Apache httpd 2.4.6) y el 3306(mariadb).
Empecemos explorando el puerto 80:

![alt text](img/image-1.png)

A simple vista podemos ver que se trata de una página de noticias en la cual vemos a `spiderman` y un login. Hagamosle un fuzzeo de directorios a la página:

![alt text](img/image-3.png)

    Mientras se hace el fuzzeo, veamos las tecnologías de la página:

![alt text](img/image-2.png)

    Tiene un CMS `Joomla`, el cual nos podría interesar ver su versión; usa ``PHP``, a lo mejor le podemos meter una reverse shell.

En /administrator, tenemos un login de ``Joomla!``:

![alt text](img/image-4.png)

Vamos a ver que podemos hacer con Joomla, escaneemos la versión instalada:

![alt text](img/image-5.png)
![alt text](img/image-6.png)
![alt text](img/image-7.png)

> Esta herramienta, que podemos instalar con ``sudo apt install joomscan`` y usar con ``joomscan -u URL``, nos permite saber la versión instalada de joomla, además de comprobar la existencia de los archivos por defecto.

Nos dicen que busquemos la contraseña hasheada de Jonah, pero sin utilizar sqlmap. Vamos a usar el siguiente [script](https://github.com/teranpeterson/Joomblah).

![alt text](img/image-8.png)

Como se puede ver, es muy fácil de usar y lo hace todo automático. Ahora tenemos que crackear la contraseña, lo voy a hacer con john the reaper.

1. Identificamos la id del hash.
2. Guardamos el hash en un archivo.
3. Hacemos un ataque por diccionario.

![alt text](img/image-9.png)

Si lo hemos hecho bien, nos saldrá la contraseña de Jonah:

![alt text](img/image-10.png)

Con esta contraseña podemos:

![alt text](img/image-11.png)
> iniciar sesión como administrador(?).

![alt text](img/image-12.png)
> Iniciar sesión en el /administrator.

Ahora que somos super usuarios(en la página web...), podemos probar que pasa si modificamos un archivo. Para ello vamos a irnos a la siguiente pestaña:

![alt text](img/image-13.png)
![alt text](img/image-14.png)

Podríamos intentar cambiar el código de error de la página y hacer que, al conectarnos, se cree una [reverse shell](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php).

![alt text](img/image-15.png)

Ponemos nuestra IP y un puerto, guardamos los cambios y ponemos el ``template`` modificado por defecto.

![alt text](img/image-17.png)

Ahora ponemos el puerto en escucha con ``nc -lvp 1234``.

Y, en teoría, si ponemos una URL que no exista(error 404), deberíamos crear una reverse shell:

![alt text](img/image-16.png)

Vale, parece que la página no está procesando los errores 404, ponemos la URL directamente:

![alt text](img/image-18.png)
> Sabemos el nombre del template y del archivo.

![alt text](img/image-19.png)

En este punto, tenemos que buscar la user.txt, escalar privilegios y buscar la root.txt.

![alt text](img/image-20.png)

Parece que tambien tendremos que escalar privilegios para ser usuarios ``normales`` primero.

Echemos le un vistazo a los usuarios de la máquina:

![alt text](img/image-23.png)
> Encontramos a jjameson y root obviamente.

Vemos los archivos de la carpeta ``/var/www/html```:

![alt text](img/image-21.png)

Tenemos este archivo de configuración, que si exploramos un poco, encontramos una contraseña(y un secreto?):

![alt text](img/image-22.png)
> nv5uz9r3ZEDzVjNu

Probamos iniciar sesión con estas credenciales:

![alt text](img/image-24.png)
> No se ve la bash, pero ha funcionado.

![alt text](img/image-25.png)
> Encontramos la primera flag.

Veamos los permisos que tiene ``jjameson``:

![alt text](img/image-26.png)

``yum`` es un gestor de paquetes como puede ser apt, snap o pacman, y vemos que el usuario jjameson puede ejecutar ese binario como administrador. 

Usamos [gtfobins](https://gtfobins.github.io/) para ver que podemos hacer con yum.

Tenemos que copiar y pegar esto:

![alt text](img/image-27.png)
![alt text](img/image-28.png)

Terminamos con la escalada de privilegios y buscamos la flag que nos queda:

![alt text](img/image-29.png)

