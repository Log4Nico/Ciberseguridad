# Kenobi

# Falta terminar de documentar

# Proceso

Scan the machine with nmap, how many ports are open?
![alt text](img/image.png)
![alt text](img/image-1.png)
> Reaamente, en la imágen vemos 11, pero quitando los desconocidos nos quedan 7.

Vemos que existe un smb en el puerto 139 y 445

Podemos usar este comando:

```bash
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse {ip_target}
```

para enumerar las carpetas compartidas.

![alt text](img/image-2.png)

Vemos un usuario anonymous, vamos a intentar conectarnos desde nuestra kali:
![alt text](img/image-3.png)

Al listar los archivos, vemos que existe un archivo log.txt
Podemos descargarlo con `get log.txt`

En el archivo podemos encontrar información relevante como:

- Claves SSG
![alt text](img/image-4.png)

<br>

- Información sobre el servidor ProFTPD
![alt text](img/image-5.png)
> El servidor FTP se está ejecutando en el puerto 21

<br>

Antes vimos que el puerto 111 estaba abierto con el servicio **RCP**
![alt text](img/image-6.png)

Sigamos viendo el servicio FTP y veamos que versión de ProFTPD tiene instalado:
![alt text](img/image-7.png)

Es una versión bastante antigua del servicio, podemos buscar a ver si existe algún exploit para esta versión:
![alt text](img/image-8.png)
> 4 en total

En el log.txt, vimos que existe un usuario *kenobi*, que lo podemos usar en el **FTP**
![alt text](img/image-9.png)
![alt text](img/image-10.png)

De esta forma, conseguimos copiar los archivos *key* de ssh de la otra máquina a nuestro **PC**.
Nos la copiamos a nuestro directorio, le cambiamos los permisos e iniciamos sesión con ella por ssh:
![alt text](img/image-11.png)

Sacamos la flag del usuario kenobi:
![alt text](img/image-12.png)
> d0b0f3f53b6caa532a83915e19224899

Intentemos ahora escalar privilegios. La máquina está preparada para escalar privilegios con permisos de los archivos. Vamos a buscar algún archivo con el SUID activado(esto permite que cualquier usuario pueda ejecutar el archivo con los mismos permisos que el creador de este). Vamos a buscar algún archivo con estas caracteristicas:
```bash
find / -perm -u=s -type f 2>/dev/null
```

![alt text](img/image-14.png)

El único destacable, al menos porque no me suena de nada, es *menu*, voy a ejecutarlo a ver que pasa:
![alt text](img/image-15.png)

Parece que este *menu* está ejecutando los siguientes comandos:
![alt text](img/image-16.png)

Ponemos los siguientes comandos en la terminal:
![alt text](img/image-17.png)

Esto basicamente esta creando un *script* con el contenido /bin/bash, le da todos los permisos para que la aplicación *menu* lo pueda ejecutar, y exporto el el directorio actual al PATH.

Y si ahora ejecutamos el *menu* y ponemos la opción 3:
![alt text](img/image-18.png)

Somos root.
![alt text](img/image-19.png)